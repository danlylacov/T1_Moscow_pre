docker_build:
  stage: docker_build
  image: docker:24
  services:
    - docker:24-dind
  variables:
    DOCKER_HOST: tcp://docker:2375
  script:
    - docker build -f {{ ctx.dockerfile_path }} -t $DOCKER_IMAGE:$DOCKER_TAG {{ ctx.docker_context }}
    - docker save -o image.tar $DOCKER_IMAGE:$DOCKER_TAG || true
  artifacts:
    paths:
      - image.tar
