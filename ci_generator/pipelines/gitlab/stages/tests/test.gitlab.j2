test:
  stage: test
  image: python:{{ ctx.python_version }}
  script:
    - pip install -r requirements.txt || true
    {% set runner = (ctx.analysis.test_runner or '').lower() %}

    {# pytest (по умолчанию, если runner не указан) #}
    {% if runner == 'pytest' or runner == '' %}
    - pip install pytest pytest-cov || true
    - pytest --junitxml=test-results.xml --cov=. || true
  artifacts:
    when: always
    reports:
      junit: test-results.xml
    paths:
      - reports/
      - .pytest_cache/

    {# встроенный unittest #}
    {% elif runner == 'unittest' %}
    - python -m unittest discover -s tests || true

    {# nose / nose2 #}
    {% elif runner in ['nose', 'nose2'] %}
    - pip install nose2 || true
    - nose2 -v || true

    {# неизвестный тестовый фреймворк #}
    {% else %}
    - echo "Unknown or unsupported test runner: {{ runner }}" || true
    {% endif %}


